# UK Statutory Instrument Format Pattern
# Detects and parses UK secondary legislation (Statutory Instruments)
#
# This pattern file consolidates UK SI patterns for format detection,
# structure parsing, definition extraction, and cross-reference resolution.

name: "UK Statutory Instrument"
format_id: "uk-si"
version: "2.0.0"
jurisdiction: "GB"

detection:
  required_indicators:
    - pattern: '(?i)\bStatutory\s+Instrument[s]?\s+\d{4}\s+No\.\s*\d+'
      weight: 30
    - pattern: '\bS\.?I\.?\s+\d{4}/\d+'
      weight: 25

  optional_indicators:
    - pattern: '\bMade\s+\d{1,2}(?:st|nd|rd|th)?\s+\w+\s+\d{4}'
      weight: 10
    - pattern: '(?i)\bLaid\s+before\s+Parliament'
      weight: 15
    - pattern: '(?i)\bComing\s+into\s+force'
      weight: 10
    - pattern: '(?i)\bSecretary\s+of\s+State'
      weight: 8
    - pattern: '(?i)\bregulation\s+\d+'
      weight: 5
    - pattern: '(?i)\bSchedule\s+\d+'
      weight: 5
    - pattern: '(?i)\bEXPLANATORY\s+NOTE'
      weight: 10
    - pattern: '(?i)\bMade\s+under'
      weight: 8
    - pattern: '(?i)\bScottish\s+Statutory\s+Instrument'
      weight: 5

  negative_indicators:
    - pattern: '(?i)\bU\.?S\.?\s+Code\b'
      weight: -20
    - pattern: '(?i)\bEuropean\s+Parliament\b'
      weight: -10
    - pattern: '(?i)\bCalifornia\b'
      weight: -20
    - pattern: '(?i)\bVIRGINIA\b'
      weight: -10
    # Penalize when document is an Act, not an SI
    - pattern: '(?i)\bBE\s+IT\s+ENACTED\b'
      weight: -25
    - pattern: '\[\d{4}\s+c\.\s*\d+\]'
      weight: -20

structure:
  preamble:
    start_pattern: '^The\s+Secretary\s+of\s+State'
    end_pattern: '^\s*PART\s+1|^\s*1\.\s+'
    recital_pattern: ''

  hierarchy:
    - type: "part"
      pattern: '^PART\s+(\d+)\s*$'
      number_group: 1
      title_follows: true

    - type: "chapter"
      pattern: '^CHAPTER\s+(\d+)\s*$'
      number_group: 1
      title_follows: true

    - type: "section"
      pattern: '^(\d+)\.\s*[-â€”]?\s*(.+)$'
      number_group: 1
      title_inline: true

    - type: "paragraph"
      pattern: '^\((\d+)\)\s+'
      number_group: 1

    - type: "subparagraph"
      pattern: '^\(([a-z])\)\s+'
      number_group: 1

    - type: "point"
      pattern: '^\(([ivx]+)\)\s+'
      number_group: 1

    - type: "schedule"
      pattern: '^SCHEDULE\s+(\d+)\s*$'
      number_group: 1
      title_follows: true

definitions:
  location:
    - section_title: '(?i)interpretation|definitions?'
    - section_number: 2

  pattern: '(?:^|\n)\s*["""]([^"""]+)["""](?:\s+\([^)]+\))?\s+(?:means?|has\s+the\s+(?:same\s+)?meaning)'

references:
  internal:
    - pattern: 'regulation\s+(\d+)(?:\((\d+)\))?'
      target: "section"
      groups:
        regulation: 1
        paragraph: 2

    - pattern: 'paragraph\s*\((\d+)\)'
      target: "paragraph"
      groups:
        number: 1

    - pattern: 'sub-paragraph\s*\(([a-z])\)'
      target: "subparagraph"
      groups:
        letter: 1

    - pattern: 'Schedule\s+(\d+)'
      target: "schedule"
      groups:
        number: 1

    - pattern: 'Part\s+(\d+)'
      target: "part"
      groups:
        number: 1

  external:
    - pattern: 'S\.?I\.?\s+(\d{4})/(\d+)'
      type: "statutory_instrument"
      uri_template: "https://www.legislation.gov.uk/uksi/{year}/{number}"
      groups:
        year: 1
        number: 2

    - pattern: '(\d{4})\s+c\.\s*(\d+)'
      type: "act"
      uri_template: "https://www.legislation.gov.uk/ukpga/{year}/{chapter}"
      groups:
        year: 1
        chapter: 2

    - pattern: 'the\s+([A-Z][a-zA-Z\s]+)\s+Act\s+(\d{4})'
      type: "act"
      uri_template: "https://www.legislation.gov.uk/ukpga/{year}"
      groups:
        name: 1
        year: 2

    - pattern: 'Regulation\s+\(E[CU]\)\s+(?:No\s+)?(\d+)/(\d{4})'
      type: "eu_regulation"
      uri_template: "http://data.europa.eu/eli/reg/{year}/{number}/oj"
      groups:
        number: 1
        year: 2

    - pattern: 'Directive\s+(\d{4})/(\d+)/(EC|EU)'
      type: "eu_directive"
      uri_template: "http://data.europa.eu/eli/dir/{year}/{number}/oj"
      groups:
        year: 1
        number: 2
        authority: 3
